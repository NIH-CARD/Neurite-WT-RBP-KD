---
title: Final MA Plots
output:
    html_document:
        code_folding: hide
        toc: true
        toc_float: true
        toc_depth: 3
params:
    contrast_name: ''
    targeting: ''
    nontargeting: ''
    base_folder: ''
---

```{r read_data}
library(data.table)
library(dplyr)

file_list <- list.files(path = "results/", pattern = "\\.tsv$", full.names = TRUE)

# Read each TSV file into a separate data.table and store them in a list
data_tables_list <- lapply(file_list, fread)

# Extract file names without the path and extension
file_names <- basename(file_list)
file_names <- sub("\\.tsv$", "", file_names)

# Assign names to the list elements
names(data_tables_list) <- file_names

```

```{r MA function}
make_ma_plot <- function(ma_plot_data, contrast_name) {
    ggmaplot(ma_plot_data,  main = contrast_name, 
        fc=1.5, 
        fdr=0.05, 
        genenames=as.vector(ma_plot_data$SYMBOL),
    palette = c("#B31B21", "#1465AC", "darkgray"),
    top = 20,
    font.label = c("bold", 12), label.rectangle=TRUE,
    font.legend = c(size=14, "bold"),
    font.x = c(size=14, "bold"),
    font.y = c(size=14, "bold"),
    font.main = c(size = 20, "bold"),
    font.tickslab = c(size=14),
    ggtheme = ggplot2::theme_minimal(),
    size=0.5
    )
    ggsave(paste0("/data/CARD_ARDIS/2023_07_21_veronica_analysis/workflows/rnaseq/downstream/final_figures/MA_Plots/", contrast_name, ".pdf"))
}
```

```{r process_data_tables}
library(ggpubr)
mapply(make_ma_plot, data_tables_list, names(data_tables_list))
```
